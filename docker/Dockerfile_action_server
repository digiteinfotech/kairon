FROM python:3.7-buster

WORKDIR /app
USER root
RUN apt-get update -qq && \
python -m pip install --upgrade pip && \
python -m pip install tornado && \
python -m pip install mongoengine==0.23.1 && \
python -m pip install smart-config==0.1.3 && \
python -m pip install validators && \
python -m pip install rasa_sdk==2.1.2 && \
python -m pip install dnspython && \
python -m pip install pyjwt && \
python -m pip install elastic-apm
RUN python3 -m pip install pymongo==3.12.0
RUN python3 -m pip install pydantic~=1.8.2
RUN python3 -m pip install password-strength
RUN python3 -m pip install passlib[bcrypt]
RUN python3 -m pip install cryptography~=3.4.8


COPY kairon/actions /app/kairon/actions/
COPY kairon/shared/actions /app/kairon/shared/actions
COPY kairon/shared/account /app/kairon/shared/account
COPY kairon/shared/tornado /app/kairon/shared/tornado
COPY kairon/shared/utils.py /app/kairon/shared/
COPY kairon/shared/models.py /app/kairon/shared/
COPY kairon/shared/constants.py /app/kairon/shared/
COPY kairon/exceptions.py /app/kairon/exceptions.py
COPY system.yaml /app/
COPY email.yaml /app/

USER 1001
EXPOSE 5055
CMD ["python","-m", "kairon.actions.server"]

